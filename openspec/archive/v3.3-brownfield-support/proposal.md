---
status: archived
created: 2026-01-03
updated: 2026-01-04
version: 3.3.0
archived: 2026-01-04
---

# v3.3 Brownfield Support - æ£•åœ°é¡¹ç›®åå‘å·¥ç¨‹

## åŠ¨æœº (Motivation)

### å½“å‰é™åˆ¶

#### é™åˆ¶ 1ï¼šåªæ”¯æŒç»¿åœ°å·¥ä½œæµ

mob-seed v3.2 åªæ”¯æŒ"ç»¿åœ°"ï¼ˆgreenfieldï¼‰å·¥ä½œæµï¼š

```
Spec â†’ Code â†’ Docs
è§„æ ¼ â†’ ä»£ç  â†’ æ–‡æ¡£
```

è¿™å¯¼è‡´æ— æ³•å¤„ç†ï¼š

1. **å·²æœ‰ä»£ç åº“**ï¼šæ— æ³•ä¸ºç°æœ‰é¡¹ç›®ï¼ˆå¦‚ mars-nexusï¼‰å»ºç«‹è§„æ ¼åº“
2. **ä»£ç å…ˆè¡Œå¼€å‘**ï¼šå®é™…å¼€å‘ä¸­å¸¸å¸¸æ˜¯å…ˆå®ç°åŠŸèƒ½ï¼Œåè¡¥å……æ–‡æ¡£
3. **è§„æ ¼åç¦»**ï¼šä»£ç ä¿®æ”¹åï¼Œè§„æ ¼æ— æ³•è‡ªåŠ¨åŒæ­¥

#### é™åˆ¶ 2ï¼šæ¶æ„é”™ä½ï¼ˆä¸¥é‡é—®é¢˜ï¼‰

**é—®é¢˜**ï¼šé€šç”¨èƒ½åŠ›æ”¾é”™ä½ç½®ï¼Œç”¨æˆ·æ— æ³•ä½¿ç”¨

```
âŒ å½“å‰é”™è¯¯æ¶æ„ï¼š

.seed/scripts/                    â† mob-seed é¡¹ç›®è‡ªå·±çš„å®ä¾‹
â”œâ”€â”€ check-cache.js                â† åªæœ‰ mob-seed æœ‰
â”œâ”€â”€ quick-defend.js               â† åªæœ‰ mob-seed æœ‰
â”œâ”€â”€ incremental-defend.js         â† åªæœ‰ mob-seed æœ‰
â””â”€â”€ update-cache.js               â† åªæœ‰ mob-seed æœ‰

commands/defend.md æŒ‡å¯¼ç”¨æˆ·ï¼š
  node .seed/scripts/quick-defend.js    â† ç”¨æˆ·é¡¹ç›®æ²¡è¿™ä¸ªæ–‡ä»¶ï¼

mars-nexus/.seed/scripts/
  â””â”€â”€ (ç©ºçš„ï¼Œç”¨æˆ·æ— æ³•ä½¿ç”¨è¿™äº›åŠŸèƒ½)
```

**æ ¹æœ¬åŸå› **ï¼šæ··æ·†äº†"mob-seed ä½œä¸ºé¡¹ç›®"å’Œ"mob-seed ä½œä¸ºå·¥å…·"
- æ‰€æœ‰åœ¨ mob-seed å¼€å‘çš„åŠŸèƒ½éƒ½æ˜¯ä¸ºäº†**èµ‹èƒ½ç”¨æˆ·é¡¹ç›®**
- é€šç”¨èƒ½åŠ›åº”è¯¥åœ¨ `skills/mob-seed/lib/`ï¼ˆæŠ€èƒ½åº“ï¼‰
- `.seed/` åªæ˜¯ mob-seed è‡ªå·±ä½¿ç”¨å·¥å…·çš„å®ä¾‹åŒ–

### çœŸå®æ¡ˆä¾‹

åœ¨ mars-nexus é¡¹ç›®ä¸­ï¼š
- 82 ä¸ªå·²æœ‰æ¨¡å—éœ€è¦è§„æ ¼åŒ–
- æ‰‹åŠ¨ç¼–å†™è§„æ ¼å·¥ä½œé‡å·¨å¤§ï¼ˆä¼°è®¡ 160+ å°æ—¶ï¼‰
- ä½¿ç”¨æ­£åˆ™æ–¹æ¡ˆç”Ÿæˆçš„è§„æ ¼è´¨é‡ä½ï¼ˆAC å ä½ç¬¦ 100%ï¼Œæ–¹æ³•è¯†åˆ«é”™è¯¯ç‡ 15%ï¼‰

## ç›®æ ‡ (Goals)

æ”¯æŒ**åŒå‘å·¥ä½œæµ**ï¼š

| æ–¹å‘ | ç”¨é€” | ç°çŠ¶ |
|------|------|------|
| Spec â†’ Code | ç»¿åœ°é¡¹ç›® | âœ… v3.2 å·²æ”¯æŒ |
| Code â†’ Spec | æ£•åœ°é¡¹ç›® | âŒ v3.3 æ–°å¢ |

**æ ¸å¿ƒåŸåˆ™**ï¼šä¿æŒ SEED å“²å­¦ä¸å˜
- Spec ä»ç„¶æ˜¯**å•ä¸€çœŸç›¸æº**
- åå‘å·¥ç¨‹åªæ˜¯**åˆå§‹åŒ–æ‰‹æ®µ**
- ç”Ÿæˆè§„æ ¼åç«‹å³è¿›å…¥æ­£å‘ SEED æµç¨‹

## Deltaï¼ˆå˜æ›´å†…å®¹ï¼‰

### æ¶æ„ä¿®æ­£ï¼šé€šç”¨èƒ½åŠ›å½’ä½

**ç›®æ ‡**ï¼šç¡®ä¿æ‰€æœ‰åŠŸèƒ½èµ‹èƒ½ç”¨æˆ·é¡¹ç›®

#### ä¿®æ­£ 1ï¼šGit Hooks èƒ½åŠ›ç§»åŠ¨

```diff
- .seed/scripts/                    âŒ é¡¹ç›®å®ä¾‹ï¼ˆåªæœ‰ mob-seed æœ‰ï¼‰
-   â”œâ”€â”€ check-cache.js
-   â”œâ”€â”€ quick-defend.js
-   â”œâ”€â”€ incremental-defend.js
-   â””â”€â”€ update-cache.js

+ skills/mob-seed/lib/hooks/        âœ… æŠ€èƒ½åº“ï¼ˆæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
+   â”œâ”€â”€ cache-checker.js
+   â”œâ”€â”€ quick-defender.js
+   â”œâ”€â”€ incremental-defender.js
+   â””â”€â”€ cache-updater.js
```

#### ä¿®æ­£ 2ï¼šç”¨æˆ·è°ƒç”¨æ–¹å¼ç»Ÿä¸€

```bash
# âœ… æ–¹å¼ 1: é€šè¿‡å‘½ä»¤ï¼ˆæ¨èï¼Œç®€å•ï¼‰
/mob-seed defend --quick
/mob-seed defend --incremental
/mob-seed defend --cached

# âœ… æ–¹å¼ 2: ç›´æ¥è°ƒç”¨åº“ï¼ˆé«˜çº§ï¼ŒGit Hooksï¼‰
node $(claude which mob-seed)/lib/hooks/quick-defender.js

# âŒ æ—§æ–¹å¼ï¼ˆå·²åºŸå¼ƒï¼‰
node .seed/scripts/quick-defend.js    # ç”¨æˆ·é¡¹ç›®æ²¡è¿™ä¸ªæ–‡ä»¶ï¼
```

#### ä¿®æ­£ 3ï¼šæ–‡æ¡£æ›´æ–°

- `commands/defend.md` æ›´æ–°æ‰€æœ‰è„šæœ¬è·¯å¾„å¼•ç”¨
- `automation/git-hooks.fspec.md` æ›´æ–°æ´¾ç”Ÿè·¯å¾„
- Git Hooks ç¤ºä¾‹æ”¹ä¸ºè°ƒç”¨å‘½ä»¤æˆ–æŠ€èƒ½åº“

---

### æ–°å¢åŠŸèƒ½ï¼ˆBrownfield æ”¯æŒï¼‰

#### 1. `/mob-seed spec extract` - ä»ä»£ç æå–è§„æ ¼

ç²¾ç¡®æ§åˆ¶çš„è§„æ ¼æå–ï¼š

```bash
# å•æ–‡ä»¶
/mob-seed spec extract lib/engines/solo.js

# ç›®å½•æ‰¹é‡
/mob-seed spec extract lib/engines/

# è¾“å‡º
âœ… ç”Ÿæˆ 10 ä¸ªè§„æ ¼æ¨¡æ¿ï¼ˆdraft çŠ¶æ€ï¼‰
ğŸ“Š æ–‡æ¡£è¦†ç›–ç‡: 100%
ğŸ“Š æ–¹æ³•è¯†åˆ«ç‡: 98%ï¼ˆAST è§£æï¼‰
âš ï¸ FR å ä½ç¬¦: 15 ä¸ªéœ€è¦è¡¥å……
âš ï¸ AC å ä½ç¬¦: 42 ä¸ªéœ€è¦è¡¥å……
```

#### 1b. `/mob-seed brownfield` - ä¸€é”®æ£•åœ°é¡¹ç›®è¿ç§»

è‡ªåŠ¨åŒ–çš„å®Œæ•´å·¥ä½œæµï¼š

```bash
/mob-seed brownfield

# æ‰§è¡Œæ­¥éª¤
1. ğŸ” æ£€æµ‹é¡¹ç›®ç»“æ„ï¼ˆè°ƒç”¨ detect-project.jsï¼‰
2. ğŸ“¦ æ‰¹é‡æå–è§„æ ¼ï¼ˆspec extract lib/ï¼‰
3. ğŸ§  æ™ºèƒ½è¡¥å……ç»†èŠ‚ï¼ˆspec enrich --allï¼‰
4. âœ… éªŒè¯åŒæ­¥æ€§ï¼ˆdefendï¼‰
5. ğŸ“Š ç”Ÿæˆè¿ç§»æŠ¥å‘Š

# è¾“å‡º
âœ… å·²ä¸º 82 ä¸ªæ¨¡å—ç”Ÿæˆè§„æ ¼
ğŸ“Š AC è‡ªåŠ¨åŒ–ç‡: 65% (ä»æµ‹è¯•æå–)
ğŸ“Š FR è‡ªåŠ¨åŒ–ç‡: 50% (JSDoc + AI)
âš ï¸ 28 ä¸ªæ¨¡å—éœ€è¦äººå·¥å®¡æ ¸

ğŸ’¡ ä¸‹ä¸€æ­¥:
   1. å®¡æ ¸æ ¸å¿ƒæ¨¡å—è§„æ ¼ï¼ˆä¼˜å…ˆçº§1ï¼‰
   2. è¿è¡Œæµ‹è¯•éªŒè¯
   3. è¿›å…¥æ­£å‘ SEED æµç¨‹
```

**è§„æ ¼ç‰¹ç‚¹**ï¼š
- YAML frontmatter åŒ…å« `codePath` å­—æ®µ
- çŠ¶æ€ä¸º `draft`ï¼ˆæ˜ç¡®éœ€è¦äººå·¥å®¡æ ¸ï¼‰
- ä» JSDoc æå–æ¦‚è¿°å’Œç±»ç»“æ„
- AC ä¸ºå ä½ç¬¦ï¼ˆç­‰å¾… enrich è¡¥å……ï¼‰

#### 2. `/mob-seed spec enrich` - æ™ºèƒ½è¡¥å……è§„æ ¼

ä»æµ‹è¯•æ–‡ä»¶è‡ªåŠ¨æå– ACï¼š

```bash
/mob-seed spec enrich engines-solo.fspec.md

# è¾“å‡º
âœ… ä» test/engines/solo.test.js æå– 12 ä¸ª AC
âœ… AI åˆ†æç”Ÿæˆ 4 ä¸ª FR å»ºè®®
ğŸ“ è§„æ ¼çŠ¶æ€: draft â†’ review
```

**è¡¥å……å†…å®¹**ï¼š
- ACï¼šä»æµ‹è¯•ç”¨ä¾‹çš„ `test('...')` æè¿°æå–
- FRï¼šä»æ–¹æ³•çš„ JSDoc å’Œ AI åˆ†æç”Ÿæˆ
- ä¾èµ–å…³ç³»ï¼šä» import è¯­å¥æå–

#### 3. `/mob-seed defend --sync-direction=code` - åå‘åŒæ­¥

ä»£ç ä¿®æ”¹åè‡ªåŠ¨æ›´æ–°è§„æ ¼ï¼š

```bash
/mob-seed defend --sync-direction=code

# æ£€æµ‹åˆ°ä»£ç å˜æ›´
âš ï¸ ä»£ç å˜æ›´æ£€æµ‹åˆ°è§„æ ¼åç¦»:

æ–‡ä»¶: lib/engines/solo.js
å¯¹åº”è§„æ ¼: openspec/specs/engines-solo.fspec.md

å˜æ›´:
  + newMethod() - éœ€è¦è¡¥å…… AC
  - oldMethod() - æ ‡è®°ä¸ºå·²åºŸå¼ƒ
  ~ execute() - éœ€è¦å®¡æŸ¥å®ç°æ˜¯å¦ä»ç¬¦åˆè§„æ ¼

å»ºè®®:
  1. è¿è¡Œ /mob-seed spec enrich engines-solo.fspec.md
  2. æ‰‹åŠ¨å®¡æ ¸è§„æ ¼å˜æ›´
  3. è¿è¡Œæµ‹è¯•éªŒè¯
```

### æ–°å¢æ¨¡å—

#### æ ¸å¿ƒåº“ï¼ˆ`skills/mob-seed/lib/`ï¼‰

```
lib/
â”œâ”€â”€ spec/
â”‚   â”œâ”€â”€ from-code.js              # ä¸»å…¥å£ï¼Œè°ƒç”¨ reverse-engineer
â”‚   â”œâ”€â”€ enrich.js                 # æ™ºèƒ½è¡¥å……å¼•æ“
â”‚   â””â”€â”€ parser.js                 # è§„æ ¼æ–‡ä»¶è§£æ/å†™å…¥
â”‚
â”œâ”€â”€ defend/
â”‚   â””â”€â”€ bidirectional-sync.js     # åŒå‘åŒæ­¥æ£€æŸ¥
â”‚
â””â”€â”€ utils/
    â””â”€â”€ ast-helpers.js            # AST é€šç”¨å·¥å…·
```

#### å·¥å…·è„šæœ¬ï¼ˆ`skills/mob-seed/scripts/`ï¼‰

```
scripts/
â”œâ”€â”€ detect-project.js             # å·²æœ‰
â”œâ”€â”€ exec-runner.js                # å·²æœ‰
â””â”€â”€ reverse-engineer.js           # â† æ–°å¢ï¼šAST è§£æå¼•æ“
```

#### æç¤ºæ¨¡æ¿ï¼ˆ`skills/mob-seed/prompts/`ï¼‰

```
prompts/
â”œâ”€â”€ from-code.md                  # æŒ‡å¯¼ AI å¦‚ä½•åˆ†æä»£ç 
â””â”€â”€ enrich.md                     # æŒ‡å¯¼ AI å¦‚ä½•è¡¥å……è§„æ ¼
```

### æ–°å¢ä¾èµ–

åœ¨ `skills/mob-seed/package.json`ï¼š

```json
{
  "dependencies": {
    "@babel/parser": "^7.23.0",
    "@babel/traverse": "^7.23.0"
  }
}
```

**ä¾èµ–ç†ç”±**ï¼š
- `@babel/parser`ï¼šç²¾ç¡®è§£æ JavaScript ä»£ç ä¸º ASTï¼ˆé¿å…æ­£åˆ™è¯¯åŒ¹é…ï¼‰
- `@babel/traverse`ï¼šéå† AST èŠ‚ç‚¹æå–ç±»/æ–¹æ³•/æ³¨é‡Š

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | å˜æ›´é‡ |
|------|----------|--------|
| `commands/spec.md` | æ‰©å±• | +400 è¡Œï¼ˆæ“ä½œ 4, 5, 6ï¼‰ |
| `commands/defend.md` | æ‰©å±• | +100 è¡Œï¼ˆé€‰é¡¹ 3ï¼‰ |
| `CLAUDE.md` | æ–°å¢æ•™è®­ | +50 è¡Œï¼ˆç»éªŒæ•™è®­ #18ï¼‰ |
| `CHANGELOG.md` | æ–°å¢ç‰ˆæœ¬ | +30 è¡Œï¼ˆv3.3.0ï¼‰ |
| `README.md` | æ–°å¢ç« èŠ‚ | +80 è¡Œï¼ˆBrownfield Projectsï¼‰ |
| `README.zh-CN.md` | æ–°å¢ç« èŠ‚ | +80 è¡Œï¼ˆä¸­è‹±åŒæ­¥ï¼‰ |

## è§„æ ¼æ¸…å•

### æ¶æ„ä¿®æ­£è§„æ ¼

| è§„æ ¼æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|----------|------|------|
| `architecture-refactor.fspec.md` | draft | REFACTOR-001: é€šç”¨èƒ½åŠ›å½’ä½ |

### Brownfield åŠŸèƒ½è§„æ ¼

| è§„æ ¼æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|----------|------|------|
| `spec-extract.fspec.md` | draft | FR-001: spec extract å‘½ä»¤ |
| `spec-enrich.fspec.md` | draft | FR-002: spec enrich å‘½ä»¤ |
| `brownfield.fspec.md` | draft | FR-003: brownfield ä¸€é”®è¿ç§» |
| `defend-bidirectional.fspec.md` | draft | FR-004: defend åŒå‘åŒæ­¥ |
| `reverse-engineer-ast.fspec.md` | draft | FR-005: AST å·¥å…·è„šæœ¬ |

## å®æ–½è®¡åˆ’

### é˜¶æ®µ 0ï¼šæ¶æ„ä¿®æ­£ï¼ˆ0.5 å¤©ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼‰

> **ä¸ºä»€ä¹ˆä¼˜å…ˆ**ï¼šç¡®ä¿æ‰€æœ‰åç»­åŠŸèƒ½éƒ½èƒ½è¢«ç”¨æˆ·ä½¿ç”¨

1. **ç§»åŠ¨é€šç”¨èƒ½åŠ›**ï¼ˆREFACTOR-001ï¼‰
   - ç§»åŠ¨ `.seed/scripts/*.js` â†’ `skills/mob-seed/lib/hooks/`
   - é‡å‘½åæ–‡ä»¶ï¼ˆç»Ÿä¸€å‘½åè§„èŒƒï¼‰
   - æ›´æ–°æ‰€æœ‰å†…éƒ¨å¼•ç”¨

2. **æ‰©å±• defend å‘½ä»¤**
   - æ·»åŠ  `--quick`, `--incremental`, `--cached` é€‰é¡¹
   - å†…éƒ¨è°ƒç”¨ `lib/hooks/` è„šæœ¬

3. **æ›´æ–°æ–‡æ¡£å’Œè§„æ ¼**
   - `commands/defend.md` æ›´æ–°ç¤ºä¾‹
   - `automation/git-hooks.fspec.md` æ›´æ–°æ´¾ç”Ÿè·¯å¾„
   - éªŒè¯ç”¨æˆ·é¡¹ç›®å¯æ­£å¸¸è°ƒç”¨

### é˜¶æ®µ 1ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ1-2 å¤©ï¼‰

4. **spec extract å‘½ä»¤**ï¼ˆFR-001ï¼‰
   - å®ç° AST è§£æå¼•æ“
   - ç”Ÿæˆè§„æ ¼æ¨¡æ¿éª¨æ¶
   - ç¼–å†™å•å…ƒæµ‹è¯•

5. **reverse-engineer è„šæœ¬**ï¼ˆFR-005ï¼‰
   - å®ç° extractMethodsAST()
   - å®ç° extractTestCases()
   - éªŒè¯å‡†ç¡®ç‡ > 95%

### é˜¶æ®µ 2ï¼šæ™ºèƒ½è¡¥å……ï¼ˆ1 å¤©ï¼‰

6. **spec enrich å‘½ä»¤**ï¼ˆFR-002ï¼‰
   - ä»æµ‹è¯•æ–‡ä»¶æå– AC
   - AI è¾…åŠ©ç”Ÿæˆ FR
   - ç¼–å†™é›†æˆæµ‹è¯•

### é˜¶æ®µ 3ï¼šä¸€é”®è¿ç§»ï¼ˆ0.5 å¤©ï¼‰

7. **brownfield å‘½ä»¤**ï¼ˆFR-003ï¼‰
   - ç¼–æ’å®Œæ•´å·¥ä½œæµ
   - ç”Ÿæˆè¿ç§»æŠ¥å‘Š
   - ç”¨æˆ·å¼•å¯¼å’Œå»ºè®®

### é˜¶æ®µ 4ï¼šåŒå‘åŒæ­¥ï¼ˆ1 å¤©ï¼‰

8. **defend æ‰©å±•**ï¼ˆFR-004ï¼‰
   - å®ç° --sync-direction=code
   - é›†æˆ ACE è§‚å¯Ÿ
   - ç«¯åˆ°ç«¯æµ‹è¯•

### é˜¶æ®µ 5ï¼šæ–‡æ¡£å’Œå‘å¸ƒï¼ˆ0.5 å¤©ï¼‰

9. **æ–‡æ¡£æ›´æ–°**
   - README æ–°å¢ Brownfield ç« èŠ‚
   - CLAUDE.md æ–°å¢ç»éªŒæ•™è®­ #18ï¼ˆæ¶æ„åŸåˆ™ï¼‰
   - CHANGELOG ç¼–å†™ v3.3.0

10. **ç‰ˆæœ¬å‘å¸ƒ**
   - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
   - æ›´æ–°ç‰ˆæœ¬å·ï¼ˆ4 ä¸ªæ–‡ä»¶ï¼‰
   - åˆ›å»º git tag
   - å‘å¸ƒ GitHub Release

## é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| AST è§£æå¤±è´¥ | è§„æ ¼ç”Ÿæˆä¸­æ–­ | å›é€€åˆ°ç®€å•æ­£åˆ™ï¼Œæ ‡è®°ä½è´¨é‡ |
| AI è¡¥å……ä¸å‡†ç¡® | FR æè¿°è¯¯å¯¼ | æ˜ç¡®æ ‡è®°"AI ç”Ÿæˆ"ï¼Œéœ€äººå·¥å®¡æ ¸ |
| æµ‹è¯•è¦†ç›–ä¸è¶³ | AC æå–ç‡ä½ | æä¾›å ä½ç¬¦ï¼Œå¼•å¯¼ç”¨æˆ·è¡¥å…… |
| æ–°ä¾èµ–å¼•å…¥å†²çª | å®‰è£…å¤±è´¥ | ä½¿ç”¨æˆç†Ÿç¨³å®šçš„ @babel åº“ |

## æˆåŠŸæ ‡å‡†

- [ ] èƒ½å¤Ÿä¸º mars-nexus 82 ä¸ªæ¨¡å—ç”Ÿæˆè§„æ ¼ï¼ˆ30 åˆ†é’Ÿå†…ï¼‰
- [ ] æ–¹æ³•è¯†åˆ«å‡†ç¡®ç‡ > 95%ï¼ˆAST è§£æï¼‰
- [ ] AC è‡ªåŠ¨åŒ–ç‡ > 60%ï¼ˆä»æµ‹è¯•æå–ï¼‰
- [ ] æ‰€æœ‰æ–°å¢æ¨¡å—æµ‹è¯•è¦†ç›–ç‡ > 90%
- [ ] æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡

## åç»­æ¼”è¿›

v3.4 å¯èƒ½å¢å¼ºï¼š
- æ”¯æŒ TypeScriptï¼ˆ@babel/parser å·²æ”¯æŒï¼‰
- æ”¯æŒ Pythonã€Javaï¼ˆä½¿ç”¨ tree-sitterï¼‰
- ä» Git å†å²æ¨æ–­ FRï¼ˆåˆ†æ commit messageï¼‰
- AI æ·±åº¦åˆ†æä»£ç é€»è¾‘ç”Ÿæˆè¯¦ç»† FR
