# 规格验证指导

> SEED S阶段 - 规格完整性验证

## 验证目标

确保规格文件：
1. 包含所有必需章节
2. 格式正确，可被解析
3. 内容完整，足以派生产物
4. 验收标准明确可测试

## 验证检查项

### 1. 结构验证

| 检查项 | 规则 | 错误类型 |
|--------|------|----------|
| 标题存在 | 文件以 `# ` 开头 | ERROR |
| 概述章节 | 包含 `## 概述` 或 `## Overview` | ERROR |
| 需求章节 | 包含 `## 需求` 或 `## Requirements` | ERROR |
| 约束章节 | 包含 `## 约束` 或 `## Constraints` | ERROR |
| 验收标准 | 包含 `## 验收标准` 或 `## Acceptance` | ERROR |

### 2. 内容验证

| 检查项 | 规则 | 错误类型 |
|--------|------|----------|
| 概述非空 | 概述章节有实际内容 | ERROR |
| 需求编号 | 需求使用 FR-/NFR- 编号 | WARNING |
| 需求格式 | 需求使用 `- [ ]` 格式 | WARNING |
| 验收格式 | 验收标准包含 Given/When/Then | WARNING |
| 派生映射 | 包含派生产物表格 | INFO |

### 3. 一致性验证

| 检查项 | 规则 | 错误类型 |
|--------|------|----------|
| 需求覆盖 | 每个 FR 至少有一个 AC 覆盖 | WARNING |
| 路径有效 | 派生产物路径格式正确 | WARNING |
| 编号唯一 | FR/NFR/AC 编号不重复 | ERROR |

## 验证流程

```
┌─────────────────────────────────────────────────────────────┐
│                   规格验证流程                               │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. 读取规格文件                                             │
│     └── specs/{name}.fspec.md                               │
│                                                              │
│  2. 结构验证                                                 │
│     ├── 检查必需章节                                         │
│     └── 生成结构报告                                         │
│                                                              │
│  3. 内容验证                                                 │
│     ├── 检查章节内容                                         │
│     ├── 验证格式规范                                         │
│     └── 生成内容报告                                         │
│                                                              │
│  4. 一致性验证                                               │
│     ├── 需求-验收标准映射                                    │
│     └── 生成一致性报告                                       │
│                                                              │
│  5. 输出验证报告                                             │
│     └── output/mob-seed/validate-{name}.md                  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## 验证报告格式

```markdown
# 规格验证报告

> 规格: specs/user-login.fspec.md
> 验证时间: 2024-12-28 10:30:00
> 结果: ✅ 通过 / ⚠️ 警告 / ❌ 失败

## 验证摘要

| 类别 | 通过 | 警告 | 错误 |
|------|------|------|------|
| 结构 | 5 | 0 | 0 |
| 内容 | 4 | 2 | 0 |
| 一致性 | 3 | 1 | 0 |
| **总计** | **12** | **3** | **0** |

## 详细结果

### 结构验证
- ✅ 标题存在
- ✅ 概述章节存在
- ✅ 需求章节存在
- ✅ 约束章节存在
- ✅ 验收标准章节存在

### 内容验证
- ✅ 概述内容完整
- ⚠️ FR-003 缺少 `- [ ]` 格式
- ⚠️ AC-002 缺少 Then 部分

### 一致性验证
- ✅ FR-001 → AC-001
- ✅ FR-002 → AC-002
- ⚠️ FR-003 无对应验收标准

## 建议修复

1. **FR-003 格式**
   - 当前: `FR-003: 登录失败显示错误`
   - 建议: `- [ ] FR-003: 登录失败显示错误`

2. **AC-003 缺失**
   - 为 FR-003 添加验收标准
```

## 错误级别

| 级别 | 符号 | 说明 | 后续操作 |
|------|------|------|----------|
| ERROR | ❌ | 阻塞性问题 | 必须修复后才能继续 |
| WARNING | ⚠️ | 潜在问题 | 建议修复 |
| INFO | ℹ️ | 信息提示 | 可选优化 |

## 自动修复

部分问题支持自动修复：

```bash
/mob-seed-spec "user-login" --validate --fix
```

可自动修复：
- 添加缺失的 `- [ ]` 格式
- 补充空白章节模板
- 格式化表格

不可自动修复：
- 缺失的内容
- 逻辑不一致
- 需求遗漏
