# 规格创建指导

> SEED S阶段 - 单源规格定义

## 核心原则

1. **唯一真相源**: 每种信息只在规格中定义一次
2. **完整性**: 必须包含所有必需章节
3. **可派生性**: 规格内容足以自动生成代码、测试、文档
4. **可验证性**: 验收标准必须明确、可测试

## 必需章节

| 章节 | 英文 | 说明 | 必需 |
|------|------|------|------|
| 概述 | Overview | 功能描述、目标用户、核心价值 | ✅ |
| 需求 | Requirements | 功能需求 + 非功能需求 | ✅ |
| 约束 | Constraints | 技术约束 + 业务约束 | ✅ |
| 验收标准 | Acceptance Criteria | Given-When-Then 格式 | ✅ |
| 派生产物 | Derived Outputs | 代码/测试/文档路径映射 | 可选 |

## 创建流程

```
┌─────────────────────────────────────────────────────────────┐
│                   规格创建流程                               │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. 选择模板                                                 │
│     ├── feature.fspec.md  → 通用功能                        │
│     ├── api.fspec.md      → API 端点                        │
│     └── component.fspec.md → UI 组件                        │
│                                                              │
│  2. 填充概述                                                 │
│     ├── 功能做什么？                                         │
│     ├── 为谁做？                                             │
│     └── 解决什么问题？                                       │
│                                                              │
│  3. 定义需求                                                 │
│     ├── 功能需求（FR-xxx）                                   │
│     └── 非功能需求（NFR-xxx）                                │
│                                                              │
│  4. 明确约束                                                 │
│     ├── 技术栈、兼容性                                       │
│     └── 业务规则、合规                                       │
│                                                              │
│  5. 编写验收标准                                             │
│     └── Given-When-Then 格式                                │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## 需求编写规范

### 功能需求 (FR)

```markdown
- [ ] FR-001: 用户可以使用邮箱和密码登录
- [ ] FR-002: 登录成功后跳转到首页
- [ ] FR-003: 登录失败显示错误提示
```

**要求**:
- 使用 `- [ ]` 格式（可跟踪完成状态）
- 编号格式：`FR-XXX`
- 描述用户可观察的行为

### 非功能需求 (NFR)

```markdown
- [ ] NFR-001: 登录接口响应时间 < 500ms
- [ ] NFR-002: 支持 1000 并发登录请求
- [ ] NFR-003: 密码必须加密存储
```

**要求**:
- 编号格式：`NFR-XXX`
- 包含可量化的指标

## 验收标准编写规范

使用 Given-When-Then 格式：

```markdown
### AC-001: 登录成功
- **Given**: 用户已注册，且输入正确的邮箱和密码
- **When**: 用户点击登录按钮
- **Then**:
  - 页面跳转到首页
  - 显示用户名
  - 设置登录状态 Cookie
```

**要求**:
- 每个 AC 独立可测试
- 覆盖正常路径和异常路径
- 明确期望结果

## 派生产物映射

在规格中预定义产物路径，供 E 阶段（Emit）使用：

```markdown
## 派生产物 (Derived Outputs)

| 类型 | 路径 | 说明 |
|------|------|------|
| 代码 | src/auth/login.js | 登录逻辑实现 |
| 代码 | src/components/LoginForm.jsx | 登录表单组件 |
| 测试 | test/auth/login.test.js | 登录单元测试 |
| 测试 | test/e2e/login.spec.js | 登录 E2E 测试 |
| 文档 | docs/auth/login.md | 登录功能文档 |
```

## 常见问题

### Q: 规格太长怎么办？

拆分为多个规格文件：
```
specs/
├── user-auth.fspec.md      # 主规格
├── user-auth-login.fspec.md    # 子规格：登录
├── user-auth-register.fspec.md # 子规格：注册
└── user-auth-logout.fspec.md   # 子规格：登出
```

### Q: 如何处理依赖关系？

在规格中添加依赖章节：
```markdown
## 依赖 (Dependencies)
- 前置规格: user-auth.fspec.md
- 外部依赖: JWT 库, bcrypt
```

### Q: 规格变更如何处理？

1. 修改规格文件
2. 运行 `/mob-seed-defend` 检查一致性
3. 运行 `/mob-seed-emit` 重新派生产物
